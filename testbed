#!/bin/bash
  
testbed() {
  
# SetLabel() has been written, tested and transferred to achooparts (line 307)

# Testing split SetLabel and EditLabel

BuildPartitionLists # Display information about the available partitions

AllocateRoot

if [ -n "${PartitionList}" ]
then
  AllocateSwap
fi

# Check contents of PartitionList again. If not empty, call the MorePartitions function
if [ -n "${PartitionList}" ]
then
  MorePartitions
fi

# Check array contents - also use similar at the mkfs stage
    echo ${LabellingArray[sda1]}
    echo ${LabellingArray[sda2]}
    echo ${LabellingArray[sda3]}
    read -p "Line $LINENO: Check LabellingArray contents"

# Next code needed is at the mkfs stage, to add any labels as partitions are made

# MountPartitions() {
echo "... Running"
    # Here ...
  Partition=`echo ${AddPartList[3]} | cut -c 6-`
read -p "Line $LINENO: Partition = ${Partition}"
  Label="${LabellingArray[${Partition}]}"
read -p "Line $LINENO: Label = ${Label}"
  if [ -n "${Label}" ]; then
    Label="-L ${Label}"
read -p "Line $LINENO: Label = ${Label}"    
  fi
read -p "Line $LINENO: mke2fs ${Label} -t ${AddPartType[3]} ${AddPartList[3]}"  
    # mke2fs ${Label} -t ${AddPartType[3]} ${AddPartList[3]}

}

# ~~~~~~~
#	Execute
# ~~~~~~~
  
# First check for external functions and variables files
  if [[ -f `pwd`/achoofuncs ]]; then
    source achoofuncs
  else
    echo "missing file: achoofuncs"
    exit 1
  fi
  
  if [[ -f `pwd`/achooparts ]]; then
    source achooparts
  else
    echo "missing file: achooparts"
    exit 1
  fi
  
  if [[ -f `pwd`/achoodesktop ]]; then
    source achoodesktop
  else
    echo "missing file: achoodesktop"
    exit 1
  fi
  
  if [[ -f `pwd`/achoolux ]]; then
    source achoolux
  else
    echo "missing file: achoolux"
    exit 1
  fi
  
  if [[ -f `pwd`/achoorunning ]]; then
    source achoorunning
  else
    echo "missing file: achoorunning"
    exit 1
  fi
  
  # Various variables
  UEFI=0
  RootPartition="sda10"
  RootType="ext4"
  SwapPartition="sda7"
  PartitionList="sda2 sda3"
  AddPartList[0]="sda9"
  AddPartLabel[0]="/home"
  AddPartType[0]="ext4"
  AddPartList[1]="sda5"
  AddPartLabel[1]="/spare"
  AddPartType[1]="ext4"
  GrubDevice="/dev/sda"
  CountryCode="GB"
  CountryLocale="en_GB.UTF-8"
  Countrykbd="uk"
  ZONE="Europe"
  SUBZONE="London"
  DesktopEnvironment="xfce4"
  DisplayManager="lightdm"
  Greeter="lightdm-gtk-greeter"
  LuxuriesList="firefox libreoffice-still geany pamac-aur"
  HostName="ArchLinux"
  RootPassword="Root"
  UserName="archie"
  UserPassword="Linux"
  DesktopEnvironment="Gnome"
  
  # Call the function 'testbed' holding code to be tested
  testbed
  echo $* # Add any variables needed for viewing before exit
  echo "Finished"
  
  exit
  
  # Code for checking arrays
  Counter=0
  for i in ${AddPartList[@]}	
  do
    echo ${AddPartList[$Counter]}
    echo ${AddPartLabel[$Counter]} 
    echo ${AddPartType[$Counter]}
    Counter=$((Counter+1))
  done
  
